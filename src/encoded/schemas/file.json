{
    "title": "Data file",
    "description": "Schema for submitting metadata for a data file.",
    "id": "/profiles/file.json",
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "required": ["dataset", "file_format", "md5sum", "output_type", "award", "lab"],
    "identifyingProperties": ["uuid", "accession", "aliases"],
    "additionalProperties": false,
    "mixinProperties": [
        { "$ref": "mixins.json#/schema_version" },
        { "$ref": "mixins.json#/uuid" },
        { "$ref": "mixins.json#/accession" },
        { "$ref": "mixins.json#/submitted" },
        { "$ref": "mixins.json#/aliases" },
        { "$ref": "mixins.json#/attribution" },
        { "$ref": "mixins.json#/accessioned_status" },
        { "$ref": "mixins.json#/notes" }
    ],
    "facets": {
        "status": {
            "title": "File status",
            "type": "string"
        },
        "output_type": {
            "title": "Output type",
            "type": "string"
        },
        "file_format": {
            "title": "File format",
            "type": "string"
        },
        "lab.title": {
            "title": "Lab",
            "type": "string"
        }
    },
    "dependencies": {
        "paired_end": {
            "oneOf": [
                {
                   "required": ["paired_with"],
                    "properties": {
                        "paired_end": {
                            "enum": ["2"]
                        }
                    }
                },
                {
                    "properties": {
                        "paired_end": {
                            "enum": ["1"]
                        }
                    }
                }
            ]
        },
        "paired_with": {
            "required": ["paired_end"],
            "properties": {
                "file_format": {
                    "enum": ["fastq", "csfasta", "csqual"]
                },
                "paired_end": {
                    "enum": ["2"]
                }
            }
        },
        "file_format":{
            "oneOf": [
                {
                    "required": ["replicate"],
                    "properties": {
                        "file_format": {
                            "enum": ["fastq"]
                        }
                    }
                },
                {
                    "required": ["file_format_type"],
                    "properties": {
                        "file_format": {
                            "enum": ["gff","bed","bigBed"]
                        }
                    }
                },
                {
                    "not": {
                        "properties": {
                            "file_format": {
                                "enum": ["fastq", "gff", "bed", "bigBed"]
                            }
                        }
                    }
                }
            ]
        }
    },
    "properties": {
        "schema_version": {
            "default": "4"
        },
        "accession": {
            "accessionType": "FF"
        },
        "file_format": {
            "title": "File format",
            "type": "string",
            "oneOf": [
                {
                    "enum": [
                        "bam",
                        "bed",
                        "bigBed",
                        "bigWig",
                        "fasta",
                        "fastq",
                        "gff",
                        "gtf",
                        "hdf5",
                        "idat",
                        "rcc",
                        "CEL",
                        "tsv",
                        "csv"
                    ]
                },
                {
                    "comment": "Historical file formats, not valid for new submissions.",
                    "permission": "import_items",
                    "enum": [
                        "tar",
                        "2bit",
                        "csfasta",
                        "csqual"
                    ]
                }
            ]
        },
        "file_format_type": {
            "title": "Specific file format type",
            "description": "Files of type bed and gff require further specification",
            "type": "string",
            "oneOf": [
                {
                    "enum": [
                        "bed6",
                        "bed9",
                        "bedGraph",
                        "bedLogR",
                        "bedMethyl",
                        "broadPeak",
                        "gff2",
                        "gff3",
                        "narrowPeak"
                    ]
                },
                {
                    "comment": "Historical file formats, not valid for new submissions.",
                    "permission": "import_items",
                    "enum": [
                        "unknown",
                        "bedRnaElements"
                    ]
                }
           ]
        },
        "file_format_specifications": {
            "title": "File format specifications documents",
            "description": "Text or .as files the further explain the file format",
            "type": "array",
            "items": {
                    "comment": "See document.json for a list of available identifiers.",
                    "type": "string",
                    "linkTo": "document"
                    }
        },
        "md5sum": {
            "title": "MD5sum",
            "description": "The md5sum of the file being transferred.",
            "comment": "This can vary for files of same content gzipped at different times",
            "type": "string",
            "format": "hex"
        },
        "content_md5sum": {
            "title": "Content MD5sum",
            "description": "The MD5sum of the uncompressed file.",
            "comment": "This is only relavant for gzipped files.",
            "type": "string",
            "format": "hex"
        },
        "file_size": {
            "title": "File size",
            "comment": "File size is specified in bytes",
            "type": "integer"
        },
        "platform": {
            "title": "Platform",
            "description": "The measurement device used to collect data.",
            "comment": "See platform.json for available identifiers.",
            "type": "string",
            "linkTo": "platform"
        },
        "read_length": {
            "title": "Read length",
            "description": "For high-throughput sequencing, the number of contiguous nucleotides determined by sequencing.",
            "type": "integer"
        },
        "flowcell_details": {
            "title": "Flowcells",
            "description": "For high-throughput sequencing, the flowcells used for the sequencing of the replicate.",
            "type": "array",
            "default": [],
            "items": {
                "title": "Flowcell details",
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "machine": {
                        "title": "Machine Name",
                        "description": "The lab specific name of the machine used.",
                        "type": "string"
                    },
                    "flowcell": {
                        "title": "Flowcell ID",
                        "type": "string"
                    },
                    "lane": {
                        "title": "Lane",
                        "type": "string"
                    },
                    "barcode": {
                        "title": "Barcode",
                        "type": "string"
                    }
                }
            }
        },
        "output_type": {
            "title": "Output type",
            "description": "A description of the file's purpose or contents.",
            "type": "string",
            "oneOf": [
                {
                    "enum": [
                        "idat green channel",
                        "idat red channel",
                        "sequencing reads",
                        "raw data",
                        
                        "alignments",
                        "transcriptome alignments",

                        "multi-read minus signal",
                        "multi-read plus signal",
                        "multi-read signal",
                        "multi-read normalized signal",
                        "raw minus signal",
                        "raw plus signal",
                        "raw signal",
                        "raw normalized signal",
                        "unique minus signal",
                        "unique plus signal",
                        "unique signal",
                        
                        "exon quantifications",
                        "gene quantifications",
                        "transcript quantifications",
                        "library fraction",
                        "enrichment",

                        "copy number variants",
                        
                        "enhancer validation",
                        "hotspots",
                        "chromatin interactions",
                        "methyl CG",
                        "methyl CHG",
                        "methyl CHH"
                        "peaks",
                        "RNA-binding protein associated mRNAs",
                        "sites",                        
                        "splice junctions",
                        
                        "genome reference",
                        "genome index",
                        "spike-in sequence",
                        
                        "HMM"

                    ]
                },
                {
                    "comment": "Historical output types, not valid for new submissions.",
                    "permission": "import_items",
                    "enum": [
                        "rejected reads",

                        "spike-in alignments",

                        "signal",
                        "minus signal",
                        "plus signal",
                        "summed densities signal",
                        "percentage normalized signal",
                        "base overlap signal",
                        "wavelet-smoothed signal"

                        "filtered modified peptide mapping",
                        "unfiltered modified peptide mapping",
                        "filtered peptide mapping",
                        "unfiltered peptide mapping",

                        "clusters",
                        "contigs",
                        "PrimerPeaks",
                        "Matrix",
                        "transfrags",
                        "filtered transfrags"
                        "valleys",
                        
                        "sequence alignability",
                        "sequence uniqueness",
                        "primer sequence",
                        "Excludable",
                        
                        "unknown",
                        "predicted forebrain enhancers",
                        "predicted heart enhancers",
                        "predicted wholebrain enhancers",
                        "enhancers",
                        "HMM transcription start sites",
                        "UniformlyProcessedPeakCalls"
                    ]
                }
            ]
        },
        "run_type": {
            "title": "Run type for sequencing files",
            "description": "Whether this file part of a single, paired or mixed run",
            "type": "string",
            "enum": [
                "single-ended",
                "paired-ended",
                "mixed",
                "unknown"
            ]
        },
        "paired_end": {
            "title": "Paired End Identifier",
            "description": "Which pair the file belongs to (if paired end library)",
            "type": "string",
            "enum": [
                "1",
                "2"
            ]
        },
        "derived_from": {
            "title": "Derived from",
            "description": "The files participating as inputs into software to produce this output file.",
            "type": "array",
            "items": {
                    "comment": "See file.json for a list of available identifiers.",
                    "type": "string",
                    "linkTo": "file"
                    }
        },
        "controlled_by": {
            "title": "Controlled by",
            "description": "The files that control this file. ",
            "type": "array",
            "items": {
                    "comment": "See file.json for a list of available identifiers.",
                    "type": "string",
                    "linkTo": "file"
            }
        },
        "supercedes": {
            "title": "Supercedes" ,
            "description": "The files that this file replaces.",
            "type": "array",
            "items": {
                    "comment": "See file.json for a list of available identifiers.",
                    "type": "string",
                    "linkTo": "file"
            }
        },
        "paired_with": {
            "title": "File pairing",
            "description": "The file that corresponds with this file.",
            "comment": "See file.json for a list of available identifiers.",
            "type": "string",
            "linkTo": "file"
        },
        "dataset": {
            "title": "Dataset",
            "description": "The experiment or dataset the file belongs to.",
            "comment": "For experiments, see experiment.json for available identifiers. For datasets, see dataset.json for available identifiers.",
            "type": "string",
            "linkTo": ["experiment", "dataset"]
        },
        "replicate": {
            "title": "Replicate",
            "description": "The experimental replicate designation for the file.",
            "comment": "See replicate.json for available identifiers.",
            "type": "string",
            "linkTo": "replicate"
        },
        "assembly": {
            "title": "Mapping assembly",
            "description": "Genome assembly that files were mapped to.",
            "comment": "Applies to mapped files (e.g. BAM, BED and BigWig).",
            "type": "string",
            "enum": [
                "mm9",
                "mm10",
                "hg19",
                "GRCh38",
                "ce10",
                "dm3",
                "dm6"
                ]
        },
        "genome_annotation": {
            "title": "Genome annotation",
            "description": "Genome annotation that file was generated with.",
            "comment": "Applies to files created using annotations.",
            "type": "string",
            "permission": "import_items",
            "enum": [
                "None",
                "M2",
                "M3",
                "M4",
                "V3c",
                "V7",
                "V10",
                "V19",
                "ENSEMBL V65"
                ]
        },
        "submitted_file_name": {
            "title": "Original file name",
            "description": "The local file name used at time of submission.",
            "type": "string"
        },
        "status": {
            "title": "Status",
            "type": "string",
            "default": "uploading",
            "enum" : [
                "uploading",
                "uploaded",
                "upload failed",
                "format check failed",
                "in progress",
                "deleted",
                "replaced",
                "revoked",
                "released"
                ]
        },
        "dbxrefs": {
            "@type": "@id",
            "rdfs:subPropertyOf": "rdfs:seeAlso",
            "title": "External identifiers",
            "description": "Unique identifiers from external resources.",
            "type": "array",
            "default": [],
            "items": {
                "title": "External identifier",
                "description": "A unique identifier from external resource.",
                "type":  "string",
                "pattern": "^\\S+:\\S+"
            }
        },
        "step_run": {
            "title": "Analysis step run",
            "description": "The run instance of the step the file was generated from.",
            "comment": "For steps, see analysis_step_run.json (and analysis_step.json) - may be virtual",
            "type": "string",
             "linkTo": "analysis_step_run"
        }
    },
    "columns": {
        "accession": {
            "title": "Accession",
            "type": "string"
        },
        "dataset": {
            "title": "Dataset",
            "type": "string"
        },
        "file_format": {
            "title": "File Format",
            "type": "string"
        },
        "md5sum": {
            "title": "MD5 Sum",
            "type": "string"
        },
        "output_type": {
            "title": "Output Type",
            "type": "string"
        }
    },
    "output_type_output_category": {
        "idat green channel": "raw data",
        "idat red channel": "raw data",
        "reads": "raw data",
        "rejected reads": "raw data",
        "raw data": "raw data",

        "alignments": "alignment",
        "transcriptome alignments": "alignment",
        "spike-ins": "alignment",

        "multi-read minus signal": "signal",
        "multi-read plus signal": "signal",
        "multi-read signal": "signal",
        "multi-read normalized signal": "signal",
        "raw minus signal": "signal",
        "raw plus signal": "signal",
        "raw signal": "signal",
        "raw normalized signal": "signal",
        "unique minus signal": "signal",
        "unique plus signal": "signal",
        "unique signal": "signal",
        "minus signal": "signal",
        "plus signal": "signal",
        "signal": "signal",
        "base overlap signal": "signal",
        "percentage norrmalized signal":"signal",
        "summed densities signal": "signal",
        "wavelet-smoothed signal": "signal",

        "copy number variants": "annotation",
        "clusters": "annotation",
        "contigs": "annotation",
        "enhancers": "annotation", ###
        "filtered transfrags": "annotation",
        "hotspots": "annotation",
        "chromatin interactions": "annotation",
        "peaks": "annotation",
        "Matrix": "annotation", #5c data
        "PrimerPeaks": "annotation", #5C peaks
        "UniformlyProcessedPeakCalls": "annotation", #this needs a pipeline
        "RNA-binding protein associated mRNAs": "annotation",
        "sites": "annotation",
        "splice junctions": "annotation",
        "transfrags": "annotation",
        "valleys": "annotation",
        "methyl CG": "annotation",
        "methyl CHG": "annotation",
        "methyl CHH": "annotation",
        "enhancer validation": "annotation",
                
        "Excludable": "reference",
        "genome index": "reference",
        "genome reference": "reference",
        "primer sequence": "reference",
        "sequence alignability": "reference",
        "sequence uniqueness": "reference",
        "spike-in sequence": "reference",
        
        
        "enrichment": "quantification",
        "library fraction": "quantification",
        "exon quantifications": "quantification",
        "gene quantifications": "quantification",
        "transcript quantifications": "quantification",
        "filtered modified peptide mapping": "quantification",
        "unfiltered modified peptide mapping": "quantification",
        "filtered peptide mapping": "quantification",
        "unfiltered peptide mapping": "quantification",
        
        
        "predicted forebrain enhancers": "annotation",
        "predicted heart enhancers": "annotation",
        "predicted whole brain enhancers": "annotation",
        "TssHmm":"",
        "Validation":"",
        "HMM":"",
        
    },
    "file_format_file_extension": {
        "2bit": ".2bit",
        "CEL": ".cel.gz",
        "bam": ".bam",
        "bedLogR": ".bedLogR.bigBed",
        "bedMethyl": ".bedMethyl.bigBed",
        "bedRnaElements": ".bedRnaElements.bigBed",
        "bed": ".bed.gz",
        "bed_bedLogR": ".bedLogR.gz",
        "bed_bedMethyl": ".bedMethyl.gz",
        "bed_bedRnaElements": ".bedRnaElements.gz",
        "bed_broadPeak": ".broadPeak.gz",
        "bed_narrowPeak": ".narrowPeak.gz",
        "bigBed": ".bigBed",
        "bigWig": ".bigWig",
        "broadPeak": ".broadPeak.bigbed",
        "csfasta": ".csfasta.gz",
        "csqual": ".csqual.gz",
        "fasta": ".fasta.gz",
        "fastq": ".fastq.gz",
        "gff": ".gff.gz",
        "gtf": ".gtf.gz",
        "hdf5": ".h5",
        "idat": ".idat",
        "narrowPeak": ".narrowPeak.bigBed",
        "rcc": ".rcc",
        "tar": ".tar.gz",
        "tsv": ".tsv",
        "csv": ".csv"
    }
}
