{
    "title": "Workflow",
    "description": "Schema for submitting a computational analysis workflow that is composed of analysis step(s).",
    "id": "/profiles/workflow.json",
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "required": ["title", "name", "workflow_type", "award", "lab"],
    "additionalProperties": false,
    "identifyingProperties": ["uuid", "aliases", "accession"],
    "mixinProperties": [
        { "$ref": "mixins.json#/schema_version" },
        { "$ref": "mixins.json#/aliases" },
        { "$ref": "mixins.json#/uuid" },
        { "$ref": "mixins.json#/status" },
        { "$ref": "mixins.json#/submitted" },
        { "$ref": "mixins.json#/documents" },
        { "$ref": "mixins.json#/attribution" },
        { "$ref": "mixins.json#/accession" },
        { "$ref": "mixins.json#/notes" }
    ],
    "properties": {
        "schema_version": {
            "default": "1"
        },
        "accession": {
            "accessionType": "WF"
        },
        "title": {
            "title": "Title",
            "description": "The preferred viewable name of the workflow.",
            "type": "string"
        },
        "name": {
            "title": "Name",
            "description": "The name and version of the workflow used by either SBG or Tibanna, in the format of name/version",
            "type": "string"
        },
        "description": {
            "title": "Description",
            "description": "A short text description of the workflow.",
            "type": "string"
        },
        "data_types": {
            "title": "Data types",
            "description": "Types of the data that the workflow is applied to.",
            "type": "array",
            "items": {
                "title": "Data type",
                "description": "type of data that the workflow is applied to",
                "type": "string"
            } 
        },
        "category": {
            "title": "Category",
            "description": "A short text description of the workflow's category (e.g. alignment).",
            "type": "string"
        },
        "workflow_type": {
            "title": "Workflow Type",
            "type": "string",
            "enum": [
                "Hi-C data analysis",
                "Image processing",
                "Visualization processing",
                "Data QC",
                "Other"
            ]
        },
        "workflow_diagram": {
            "title": "Workflow diagram",
            "description": "Image of workflow diagram",
            "type": "string"
        },
        "cwl_pointer": {
            "title": "SBG CWL Path",
            "description": "Path to the SBG CWL file for the workflow - URL or directory path",
            "type": "string"
        },
        "app_name": {
            "title": "App name",
            "description": "The name of the workflow app.",
            "type": "string"
        },
        "app_version": {
            "title": "App version",
            "description": "The version of the workflow app.",
            "type": "string"
        },
        "cwl_directory_url": {
            "title": "CWL directory url",
            "description": "URL of the directory that contains main and other CWL files needed for the workflow",
            "type": "string"
        },
        "cwl_main_filename": {
            "title": "CWL main file name",
            "description": "Name of the main CWL file for the workflow",
            "type": "string"
        },
        "cwl_child_filenames": {
            "title": "CWL child file names",
            "description": "Names of the other CWL files used by the main CWL file for the workflow",
            "type": "array",
            "items": {
                "title": "CWL child file name",
                "description": "name of a cwl file",
                "type": "string"
            }
        },
        "arguments": {
            "title": "Workflow Arguments",
            "description": "arguments of the workflow.",
            "type": "array",
            "items": {
                "title": "argument",
                "description": "An argument of the workflow.",
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "workflow_argument_name": {
                        "title": "Name",
                        "description": "Name of the argument of the workflow.",
                        "type": "string"
                    },
                    "secondary_file_formats": {
                        "title": "secondary file formats",
                        "description": "formats for secondary files",
                        "type": "array",
                        "items": {
                             "title": "secondary_file_format",
                             "description": "formats for secondary file",
                             "type": "string"
                        }
                    },
                    "is_primaryfile": {
                        "title": "Is Primary File",
                        "description": "Flag indicating whether the argument is a primary or secondary file. Not applicable for types other than Input file and Output processed file.",
                        "type": "boolean"
                    },
                    "linkto_primaryfile": {
                        "title": "Primary File",
                        "description": "Primary file that is related to this argument. Applicable only for Input file and Output processed file that is not a primary file.",
                        "type": "string",
                        "linkTo": "File"
                    },
                    "argument_type":{
                        "title": "Type",
                        "description": "Argument Type",
                        "type": "string",
                        "suggested_enum" : [
                            "Input file",
                            "Output processed file",
                            "Output QC file",
                            "Output report file",
                            "parameter",
                            "NA"
                        ]
                    },
                    "argument_cardinality":{
                       "title": "Cardinality",
                       "description": "Number of items in the argument, or N for dynamic number.",
                       "type": "string",
                       "default": "1"
                    },
                    "argument_format":{
                        "title": "Format",
                        "description": "Argument Format",
                        "type": "string",
                        "suggested_enum" : [
                            "fastq",
                            "bam",
                            "bai",
                            "pairs",
                            "pairsam",
                            "pairs_px2",
                            "pairsam_px2",
                            "cool",
                            "mcool",
                            "hic",
                            "bwaIndex",
                            "chromsizes",
                            "reference_fasta",
                            "juicer_format_restriction_site_file",
                            "normvector_juicerformat",
                            "zip",
                            "other"
                        ]
                    },
                    "description": {
                        "title": "Description",
                        "description": "Argument Description",
                        "type": "string"
                    },
                    "argument_mapping": {
                        "title": "Mappings",
                        "internal_comment": "same workflow argument can be passed to multiple steps",
                        "description": "Argument mapping between workflow and steps.",
                        "type": "array",
                        "items": {
                            "title" : "Mapping",
                            "type": "object",
                            "additionalProperties": false,
                            "properties": {
                                "workflow_step": {
                                    "title": "Workflow Step",
                                    "description": "Step of the workflow which accepts or outputs the file.",
                                    "type": "string",
                                    "internal_comment": "the same analysis step may appear multiple times"
                                },
                                "step_argument_name": {
                                    "title": "Step's Arg. Name",
                                    "description": "Name of the argument of the step that corresponds to the workflow argument.",
                                    "type": "string"
                                },
                                "step_argument_type": {
                                    "title": "Step's Arg. Type",
                                    "description": "Type of the argument of the step.",
                                    "type": "string",
                                    "enum": [
                                        "Input file",
                                        "Output file",
                                        "parameter",
                                        "Input file or parameter",
                                        "Output file or parameter"
                                    ]
                                }
                            }
                        }
                    }
                }
            }
        },
        "workflow_steps": {
            "title": "Workflow Steps",
            "description": "The analysis steps that comprise the workflow with info on who are their parents.",
            "type": "array",
            "items": {
                "description": "A step in the workflow and whose its parent are.",
                "title": "Step Info",
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "step": {
                        "title": "Step",
                        "description": "A step in the workflow.",
                        "type": "string",
                        "linkTo": "AnalysisStep"
                    },
                    "step_name": {
                        "title": "Workflow Step Name",
                        "description": "Name of step within this workflow. Potentially overrides step's own internal name, if necessary.",
                        "type": "string"
                    }
                }
            }
        }
    }
}
