{
    "title": "Workflow",
    "description": "Schema for submitting a computational analysis workflow that is composed of analysis step(s).",
    "id": "/profiles/workflow.json",
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "required": ["title", "workflow_type"],
    "additionalProperties": false,
    "identifyingProperties": ["uuid", "aliases", "accession"],
    "mixinProperties": [
        { "$ref": "mixins.json#/schema_version" },
        { "$ref": "mixins.json#/aliases" },
        { "$ref": "mixins.json#/uuid" },
        { "$ref": "mixins.json#/status" },
        { "$ref": "mixins.json#/submitted"},
        { "$ref": "mixins.json#/documents" },
        { "$ref": "mixins.json#/attribution" },
        { "$ref": "mixins.json#/accession" },
        { "$ref": "mixins.json#/notes"}
    ],
    "properties": {
        "schema_version": {
            "default": "1"
        },
        "accession": {
            "accessionType": "WF"
        },
        "title": {
            "title": "Title",
            "description": "The preferred viewable name of the workflow.",
            "type": "string"
        },
        "description": {
            "title": "Description",
            "description": "A short text description of the workflow.",
            "type": "string"
        },
        "workflow_type": {
            "title": "Workflow Type",
            "type": "string",
            "enum": [
                "Hi-C data analysis",
                "Image processing",
                "Visualization processing",
                "Other"
            ]
        },
        "workflow_diagram": {
            "title": "Workflow diagram",
            "description": "Image of workflow diagram",
            "comments": "static or interactive",
            "type": "file"
        },
        "cwl_pointer": {
            "title": "CWL Path",
            "description": "Path to the CWL file for the workflow - URL or directory path",
            "type": "string"
        },
        "arguments": {
            "title": "Workflow arguments",
            "comment": "The information in this 'argument' field is redundantly described in the cwl itself, but it would make it easy to reconstruct workflow graph and map to the arguments specified by the workflow_run object, if we want to use the meta data for such purpose. We could alternatively parse the cwl to get this information and delete this field. I think this information is sufficient for constructing the graph",
            "description": "arguments of the workflow.",
            "type": "array",
            "items": {
                "title": "argument",
                "description": "An argument of the workflow.",
                "type": "object",
                "additionalProperties": "false",
                "properties": {
                    "workflow_argument_name": {
                        "title": "Workflow argument name",
                        "description": "the name of the argument of the workflow that corresponds to the input file",
                        "type": "string"
                    },
                    "argument_type":{
                        "titie": "Workflow argument type",
                        "description": "type of the argument",
                        "type": "string",
                        "enum" : [
                            "Input_file",
                            "Output_file",
                            "parameter"
                        ]
                    },
                    "description": {
                        "title": "description",
                        "description": "description of the argument",
                        "type": "string"
                    },
                    "argument_mapping": {
                       "title": "argument_mapping",
                       "comment": "same workflow argument can be passed to multiple steps",
                       "description": "argument mapping between workflow and steps",
                       "type": "array",
                       "items": {
                           "workflow_step": {
                               "title": "Corresponding workflow step",
                               "description": "the step of the workflow that takes the input file",
                               "type": "string"
                           },
                           "step_argument_name": {
                               "title": "Step argument name",
                               "description": "the name of the argument of the step that corresponds to the input file",
                               "type": "string"
                           }
                       }
                }
            }
        },
        "workflow_steps": {
            "title": "Workflow Steps",
            "we may not need a separate workflow_steps field if we use the 'argument' field, but it may still be nice to have an array of workflow steps that comprise the workflow.
           "description": "The analysis steps that comprise the workflow with info on who are their parents.",
            "type": "array",
            "items": {
                "description": "A step in the workflow and whose its parent are.",
                "title": "Step Info",
                "type": "object",
                "additionalProperties": false,
                "properties": {
                    "step": {
                        "title": "Workflow Step",
                        "description": "A step in the workflow.",
                        "type": "string",
                        "linkTo": "AnalysisStep"
                    },
                    "parents": {
                        "title": "Step parents",
                        "comment": "we may not need the parents information if we use the 'argument' field instead." 
                       "description": "The analysis step(s) that directly preceed the step in the workflow",
                        "type": "array",
                        "items": {
                            "title": "Parent Step",
                            "description": "An analysis step that immediately preceeds this step.",
                            "type": "string",
                            "linkTo": "AnalysisStep"
                        }
                    }
                }
            }
        }
    }
}
