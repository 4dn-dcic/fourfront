files:
    "/opt/elasticbeanstalk/hooks/appdeploy/post/99_run_npm.sh":
        mode: "000755"
        owner: root
        group: root
        content: |
            #!/bin/bash

            # run npm install and npm build needed for application
            # these were previously run in bin/buildout as part of
            # container_commands in 20_packages.config, but that
            # stopped working.
            # commands taken from buildout.cfg

            echo "Running NPM build in 99_run_npm..."

            su -c "pushd /opt/python/current/app && npm install --python=/opt/python/run/venv/bin/python && npm run build && npm run build-scss && popd" ec2-user >> /var/log/deploy.log

            echo "Finished NPM build in 99_run_npm."
