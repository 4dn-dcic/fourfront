files:
   "/etc/filebeat/filebeat.yml":
      mode: "000755"
      owner: root
      group: root
      content: |
        filebeat:
         prospectors:
          - input_type: log
            document_type: eb-commands
            paths:
              - /var/log/eb-commandprocessor.log
          - input_type: log
            paths:
              - /var/log/eb-version-deployment.log
            ignore_older: 3h
            document_type: eb-version-deployment
          - input_type: log
            paths:
               - /var/log/eb-activity.log
            ignore_older: 3h
            document_type: eb-activity
          - input_type: log
            paths:
               - /var/log/deploy.log
            ignore_older: 3h
            document_type: ff_deploy_log 
          - input_type: log
            paths:
               - "/var/log/httpd/*"
            ignore_older: 3h
            document_type: apache 
         registry_file: /var/lib/filebeat/registry
         processors:
            - add_cloud_metadata:
        output:
           elasticsearch: 
              hosts: ["http://@@es@@"]
commands:
  1_download_filebeat:
    command: "curl -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-5.3.0-x86_64.rpm"
    cwd: /home/ec2-user
  2_sed:
    command: "sed -i 's/@@es@@/'"$ES_URL"'/' /etc/filebeat/filebeat.yml"
  3_rpm_install:
    command: "rpm -ivh --replacepkgs filebeat-5.3.0-x86_64.rpm"
    cwd: /home/ec2-user
  5_command:
    command: "/etc/init.d/filebeat start"
