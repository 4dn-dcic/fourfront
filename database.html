<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database Documentation &#8212; 4D Nucleome Portal 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The object lifecycle" href="object-lifecycle.html" />
    <link rel="prev" title="Beanstalk Deployment" href="beanstalk-deployment.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="object-lifecycle.html" title="The object lifecycle"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="beanstalk-deployment.html" title="Beanstalk Deployment"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">4D Nucleome Portal 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="static_documentation_contents.html" accesskey="U">Tutorials and Other Documents</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="database-documentation">
<h1>Database Documentation<a class="headerlink" href="#database-documentation" title="Permalink to this headline">Â¶</a></h1>
<p>The (encodeD) system uses a Postgres implementation of a document store of a <a href="#id1"><span class="problematic" id="id2">JSONLD_</span></a> object hierarchy.   Multiple view of each document are indexed in <a href="#id3"><span class="problematic" id="id4">Elasticsearch_</span></a> for speed and efficient faceting and filtering.  The JSON-LD object tree can be exported from Elasticsearch with a query, converted to <a href="#id5"><span class="problematic" id="id6">RDF_</span></a> and loaded into a <a href="#id7"><span class="problematic" id="id8">SPARQL_</span></a> store for arbitrary queries.</p>
<p><strong>POSTGRES RDB</strong></p>
<p>When an object is POSTed to a collection, and has passed schema validation, it is inserted into the Postgres object store, defined in <a href="#id9"><span class="problematic" id="id10">storage.py_</span></a>.</p>
<p>There are 7 tables in the RDB.  Of these, <a href="#id11"><span class="problematic" id="id12">Resource_</span></a> represents a single URI.  Most Resources (otherwise known as Items or simpley &#8220;objects&#8221; are represented by a single <a href="#id13"><span class="problematic" id="id14">PropSheet_</span></a>, but the facility exists for multiple PropSheets per Resource (this is used for attachments and files, in which the actual data is stored as BLOBS instead of JSON).</p>
<p>The <a href="#id15"><span class="problematic" id="id16">Key_</span></a> and <a href="#id17"><span class="problematic" id="id18">Link_</span></a> tables are indexes used for performance optimziation.  Keys are to find specific unique aliases of Resources (so that all objects have identifiers other than the UUID primary key), while Links are used to track all the JSON-LD relationships between objects (Resources).  Specifically, the Link table is accessed when an Item is updated, to trigger reindexing of all Items that imbed the updated Item.</p>
<p>The <a href="#id19"><span class="problematic" id="id20">CurrentPropSheet_</span></a> and <a href="#id21"><span class="problematic" id="id22">TransactionRecord_</span></a> tables are used to track all changes made to objects via transactions.</p>
<p>** A LOCAL SERVER **
The dev-servers command completely drops and restarts a local copy of postgres db. Posts all the objects in tests/data/inserts (plus /tests/data/documents as attachments). Then indexes them all in local elastic search.
but these dbs are both destroyed when you kill the dev-servers process</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="beanstalk-deployment.html"
                        title="previous chapter">Beanstalk Deployment</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="object-lifecycle.html"
                        title="next chapter">The object lifecycle</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/database.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="object-lifecycle.html" title="The object lifecycle"
             >next</a> |</li>
        <li class="right" >
          <a href="beanstalk-deployment.html" title="Beanstalk Deployment"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">4D Nucleome Portal 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="static_documentation_contents.html" >Tutorials and Other Documents</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, 4DN-DCIC.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.3.
    </div>
  </body>
</html>